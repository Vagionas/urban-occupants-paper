"""Census related functions and type mappings.

For definitions of any of the terms see [the original glossary]
(http://www.ons.gov.uk/ons/guide-method/census/2011/census-data/2011-census-data/2011-first-release/
2011-census-definitions/2011-census-glossary.pdf).

Census data is retrieved from nomis, see https://www.nomisweb.co.uk.
"""
from enum import Enum
import io
from pathlib import Path
import tempfile
import zipfile

import requests
import numpy as np
import pandas as pd
import geopandas as gpd

from .types import AgeStructure, EconomicActivity, Qualification, HouseholdType, Pseudo

NOMIS_KS102EW_DATASET_ID = "NM_145_1"
NOMIS_QS116EW_DATASET_ID = "NM_516_1"
NOMIS_KS501EW_DATASET_ID = "NM_623_1"
NOMIS_KS601EW_DATASET_ID = "NM_624_1"
# the following are nomis geography codes for Haringey on different layer
NOMIS_WARD_HARINGEY = "1237319929...1237319939,1237319941,1237319940,1237319942...1237319947"
NOMIS_MSOA_HARINGEY = "1245708671...1245708705,1245714941"
NOMIS_LSOA_HARINGEY = ("1249904514,1249904516,1249904519,1249904520,1249904579,1249904580," +
                       "1249904582,1249904583,1249904507,1249904515,1249904517,1249904518," +
                       "1249904633,1249904636,1249904639,1249904640,1249904634,1249904635," +
                       "1249904637,1249904638,1249904641,1249904644,1249904645,1249904648," +
                       "1249904642,1249904643,1249904646,1249904647,1249904508...1249904511," +
                       "1249904571,1249904572,1249904576,1249904577,1249904521...1249904524," +
                       "1249904617,1249904620,1249904622,1249904624,1249904625,1249904629," +
                       "1249904631,1249904632,1249904512,1249904513,1249904541,1249904542," +
                       "1249904618,1249904619,1249904621,1249904623,1249904570," +
                       "1249904573...1249904575,1249904536...1249904538,1249904540," +
                       "1249904525...1249904528,1249904626...1249904628,1249904630,1249904558," +
                       "1249904559,1249904562,1249934828,1249934829,1249904564,1249904566," +
                       "1249904567,1249904569,1249904557,1249904563,1249904565,1249904568," +
                       "1249904543,1249904544,1249904548,1249904549,1249904610,1249904612," +
                       "1249904613,1249904616,1249904609,1249904611,1249904614,1249904615," +
                       "1249904586,1249904588,1249904589,1249904592,1249904585,1249904587," +
                       "1249904590,1249904591,1249904560,1249904561,1249904602,1249904603," +
                       "1249904593...1249904595,1249904598,1249904539,1249904553,1249904555," +
                       "1249904556,1249904545...1249904547,1249904601,1249904596,1249904597," +
                       "1249904599,1249904600,1249904529,1249904530,1249904532,1249904534," +
                       "1249904531,1249904533,1249904535,1249904605,1249904550...1249904552," +
                       "1249904554,1249904604,1249904606...1249904608,1249904578,1249904581," +
                       "1249904584,1249934354")
NOMIS_OA_HARINGEY = "1254106458...1254107181,1254258316,1254262366...1254262393"
# the following are nomis geography codes for Greater London on different layer
# LSOA and OA are skipped as the collection of numbers is too large and links would become huge
NOMIS_WARD_GREATER_LONDON = ("1237319791...1237319808,1237319681...1237319688," +
                             "1237319894...1237319947,1237320029...1237320062," +
                             "1237320079...1237320117,1237320138...1237320157," +
                             "1237320197...1237320217,1237320236...1237320252," +
                             "1237320273...1237320312,1237319689...1237319790," +
                             "1237319809...1237319893,1237319948...1237320028," +
                             "1237320063...1237320078,1237320118...1237320137," +
                             "1237320158...1237320196,1237320218...1237320235," +
                             "1237320253...1237320272")

NOMIS_MSOA_GREATER_LONDON = ("1245708449...1245708476,1245708289,1245708620...1245708645," +
                             "1245715064,1245715067,1245708646...1245708705,1245714941," +
                             "1245708822...1245708865,1245708886...1245708919,1245714947," +
                             "1245708920...1245708952,1245714930,1245714931,1245714944," +
                             "1245708978...1245709014,1245709066...1245709097,1245714948," +
                             "1245709121...1245709150,1245714999,1245715000," +
                             "1245709179...1245709239,1245708290...1245708310,1245714945," +
                             "1245708311...1245708378,1245714932,1245708379...1245708448," +
                             "1245714929,1245714934,1245714936,1245708477...1245708519," +
                             "1245714935,1245708520...1245708557,1245714938," +
                             "1245708558...1245708592,1245714940,1245708593...1245708619," +
                             "1245714933,1245715072...1245715076,1245708706...1245708733," +
                             "1245714942,1245715028,1245708734...1245708794,1245714943," +
                             "1245708795...1245708821,1245714939,1245708866...1245708885," +
                             "1245708953...1245708977,1245709015...1245709042,1245714946," +
                             "1245715069,1245715070,1245709043...1245709065," +
                             "1245709098...1245709120,1245714982,1245709151...1245709178")


NOMIS_LSOA_BARKING_AND_DAGENHAM = ("1249902617...1249902622,1249902699...1249902702,1249902624," +
                                   "1249902627...1249902629,1249902652,1249902689,1249902690,1249902698," +
                                   "1249902703,1249902623,1249902649...1249902651,1249902653,1249902654," +
                                   "1249902667,1249902669...1249902672,1249902691,1249902612...1249902616," +
                                   "1249902666,1249902606...1249902609,1249902668,1249902625,1249902626," +
                                   "1249902696,1249902697,1249902655,1249902656,1249902658...1249902660," +
                                   "1249902646,1249902662...1249902665,1249902604,1249902605,1249902648," +
                                   "1249902673...1249902675,1249902692...1249902695,1249902598,1249902599," +
                                   "1249902601,1249902603,1249902597,1249902600,1249902602,1249902634,1249902657," +
                                   "1249902631,1249902632,1249902635,1249902636,1249902661,1249902643...1249902645," +
                                   "1249902647,1249902684,1249902630,1249902633,1249902639,1249902641,1249902681," +
                                   "1249902642,1249902676...1249902679,1249902637,1249902638,1249902640,1249935255," +
                                   "1249935256,1249902680,1249902682,1249902683,1249902685,1249902610,1249902611," +
                                   "1249902686...1249902688,1249934358")
NOMIS_LSOA_BERNET = ("1249902836...1249902838,1249902842,1249902880,1249902881,1249902755,1249902834,1249902835," +
                     "1249902839,1249902840,1249902754,1249902756,1249902757,1249902760,1249902873," +
                     "1249902875...1249902877,1249902879,1249902882,1249902855...1249902858,1249902758,1249902759," +
                     "1249902761...1249902763,1249902816,1249902841,1249902867,1249902868,1249902874,1249902878," +
                     "1249902859...1249902861,1249902869,1249902870,1249902704,1249902705,1249902708,1249902709," +
                     "1249902711,1249902706,1249902707,1249902710,1249902712,1249902713,1249902853,1249902854," +
                     "1249902862,1249902908,1249902910,1249902863,1249902865,1249902871,1249902872,1249902909," +
                     "1249902783,1249902817...1249902821,1249902774...1249902779,1249902746...1249902750,1249902912," +
                     "1249902844,1249902846,1249902851,1249902852,1249902843,1249902845,1249902849,1249902850," +
                     "1249902780...1249902782,1249902814,1249902815,1249902887,1249902888,1249902890,1249902905," +
                     "1249902906,1249902911,1249902864,1249902866,1249902889,1249902891,1249902892,1249902719," +
                     "1249902721,1249902722,1249902822,1249902823,1249902744,1249902745,1249902751...1249902753," +
                     "1249902903,1249902785,1249902883,1249902884,1249902886,1249902714,1249902716...1249902718," +
                     "1249902720,1249902723,1249902786,1249902787,1249902792,1249902847,1249902848,1249902715," +
                     "1249902739...1249902742,1249902764,1249902766,1249902772,1249902885,1249902904,1249902907," +
                     "1249902784,1249902788...1249902791,1249902765,1249902767...1249902770,1249902773,1249902736," +
                     "1249902737,1249902743,1249935240,1249935241,1249902827...1249902829,1249902897,1249902825," +
                     "1249902830...1249902833,1249902902,1249902771,1249902794...1249902796,1249902798,1249902801," +
                     "1249902824,1249902826,1249902898,1249902899,1249902793,1249902797,1249902799,1249902800," +
                     "1249902804,1249902805,1249902738,1249902893,1249902894,1249902896,1249902900,1249902901," +
                     "1249902734,1249902803,1249902806...1249902808,1249902813,1249902724,1249902725,1249902733," +
                     "1249902735,1249902802,1249902730,1249902809,1249902811,1249902895,1249902727,1249902731," +
                     "1249902810,1249902812,1249902726,1249902728,1249902729,1249902732")   
NOMIS_LSOA_BEXLEY = ("1249903053...1249903056,1249903003,1249903005,1249903009,1249903051,1249903052,1249903057," +
                     "1249902921,1249902923...1249902926,1249902990...1249902992,1249902995,1249902920,1249902989," +
                     "1249902993,1249902994,1249902922,1249903004,1249903006,1249903007,1249903029," +
                     "1249903024...1249903028,1249902961,1249903016...1249903021,1249902944,1249902945,1249902947," +
                     "1249903008,1249903037...1249903039,1249902955,1249902956,1249902960,1249902968,1249903022," +
                     "1249902941...1249902943,1249902946,1249903023,1249902988,1249903040...1249903043,1249902913," +
                     "1249902914,1249902957...1249902959,1249902948,1249902950,1249902953,1249902954,1249902982," +
                     "1249902976,1249902980,1249902996,1249902998,1249903001,1249903002,1249902915...1249902919," +
                     "1249902928,1249902983,1249902984,1249902997,1249902999,1249903000,1249902962...1249902967," +
                     "1249902936,1249902937,1249902949,1249902951,1249902977,1249902978,1249902981,1249902934," +
                     "1249902935,1249902938,1249902940,1249902979,1249902929...1249902931,1249902933,1249903047," +
                     "1249902952,1249903031,1249903034...1249903036,1249902939,1249903030,1249903032,1249903033," +
                     "1249903048,1249902927,1249902932,1249903010,1249903012,1249903050,1249903011,1249903013," +
                     "1249903014,1249903044,1249903049,1249902970,1249902972,1249902975,1249903015,1249903045," +
                     "1249903046,1249902969,1249902971,1249902973,1249902974,1249902985...1249902987,1249934345")
NOMIS_LSOA_BRENT = ("1249903169,1249903171,1249903172,1249903174...1249903176,1249903098,1249903099,1249903101," +
                    "1249903105,1249903170,1249903100,1249903102,1249903125,1249903173,1249935149," +
                    "1249903120...1249903124,1249903103,1249903104,1249903202,1249903203,1249903208,1249903067," +
                    "1249903071...1249903074,1249903154...1249903157,1249903159,1249903144,1249903145,1249903148," +
                    "1249903150,1249903151,1249903066,1249903068...1249903070,1249903204,1249903084,1249903201," +
                    "1249903205,1249935150,1249903083,1249903085...1249903088,1249903152,1249903153,1249903158," +
                    "1249903160,1249903146,1249903147,1249903187,1249903188,1249903193,1249903091," +
                    "1249903094...1249903096,1249903206,1249903207,1249903135...1249903140,1249903149,1249903186," +
                    "1249903189,1249903191,1249903194,1249903196...1249903198,1249935110,1249935143,1249903089," +
                    "1249903090,1249903092,1249903097,1249903141,1249903190,1249903192,1249903210,1249903212," +
                    "1249903213,1249903195,1249903199,1249903200,1249903214,1249903215,1249903178," +
                    "1249903181...1249903185,1249903075,1249903216,1249903218,1249903221,1249903223,1249903077," +
                    "1249903081,1249903082,1249903142,1249903143,1249903217,1249903219,1249903220,1249903222," +
                    "1249903093,1249903106,1249903107,1249903111...1249903113,1249903058,1249903061,1249903063," +
                    "1249903064,1249903209,1249903177,1249903179,1249903180,1249935142,1249903127...1249903131," +
                    "1249903059,1249903060,1249903062,1249903065,1249903211,1249903076,1249903078...1249903080," +
                    "1249903163,1249903108...1249903110,1249903117,1249903119,1249935141,1249935171,1249903161," +
                    "1249903162,1249903164,1249903165,1249903168,1249903114...1249903116,1249903118,1249903166," +
                    "1249903167,1249903126,1249903132...1249903134")
NOMIS_LSOA_BROMLEY = ("1249903356...1249903360,1249903362,1249903267...1249903270,1249903361,1249903376,1249903379...1249903382,1249903318...1249903320,1249903323,1249903324,1249903287...1249903289,1249903292,1249903296,1249903224,1249903228,1249903272...1249903275,1249903252,1249903254,1249903396...1249903400,1249903321,1249903322,1249903373,1249903375,1249903377,1249903383,1249903271,1249903276,1249903314,1249903315,1249903250,1249903251,1249903294,1249903295,1249903403,1249903290,1249903291,1249903293,1249903348,1249903350,1249903278,1249903280,1249903281,1249903284,1249903374,1249903307,1249903308,1249903313,1249903316,1249903317,1249903277,1249903279,1249903282,1249903283,1249903378,1249903225...1249903227,1249903232,1249903256,1249903248,1249903253,1249903255,1249903340,1249903404,1249903297...1249903299,1249903302,1249903306,1249903230,1249903246,1249903247,1249903249,1249903257,1249903401,1249903402,1249903405,1249903406,1249903408,1249903229,1249903231,1249903384,1249903386,1249903300,1249903303,1249903309...1249903311,1249903347,1249903351,1249903353...1249903355,1249903385,1249903387,1249903388,1249903390,1249903392,1249903239...1249903242,1249903341,1249903342,1249903344,1249903345,1249903409,1249903305,1249903312,1249903367,1249903389,1249903391,1249903301,1249903304,1249903364,1249903365,1249903368,1249903407,1249903410...1249903416,1249903331...1249903333,1249903335,1249903336,1249903363,1249903366,1249903369,1249903370,1249903372,1249903243...1249903245,1249903334,1249903337...1249903339,1249903343,1249903346,1249903259...1249903262,1249903371,1249903327...1249903330,1249903258,1249903263...1249903266,1249903233...1249903236,1249903238,1249903393...1249903395,1249934341,1249934342,1249903285,1249903286,1249903349,1249903352,1249934347,1249903237,1249903325,1249903326,1249934349")
NOMIS_LSOA_CAMDEN = ("1249903482...1249903484,1249903487,1249903488,1249903468...1249903471,1249903474,1249903485,1249903486,1249903496,1249903498,1249903503,1249903453...1249903455,1249903459,1249903460,1249903446...1249903449,1249903452,1249903461...1249903463,1249903467,1249903478,1249903464...1249903466,1249903476,1249903497,1249903502,1249903456...1249903458,1249903472,1249903473,1249903441,1249903445,1249903499...1249903501,1249903544...1249903548,1249903417,1249903419,1249903423,1249903424,1249903475,1249903477,1249903479...1249903481,1249903450,1249903451,1249903506,1249903507,1249903549,1249903418,1249903420...1249903422,1249903439,1249903440,1249903442...1249903444,1249903537,1249903539...1249903541,1249903543,1249903535,1249903536,1249903538,1249903542,1249903432...1249903435,1249903437,1249903431,1249903436,1249903532...1249903534,1249903504,1249903505,1249903508...1249903510,1249903438,1249903521...1249903523,1249903527...1249903531,1249903519,1249903520,1249903524...1249903526,1249903511,1249903513...1249903515,1249903428,1249903512,1249903516...1249903518,1249903425...1249903427,1249903429,1249903490...1249903492,1249903495,1249903430,1249903489,1249903493,1249903494")
NOMIS_LSOA_CITY_OF_LONDON = ("1249902593...1249902596,1249934513,1249934514")
NOMIS_LSOA_CROYDON = ("1249903711,1249903712,1249903730,1249903736,1249903738,1249903658,1249903731,1249903733,1249903734,1249903737,1249903657,1249903660,1249903661,1249903735,1249903659,1249903662...1249903665,1249903721,1249903722,1249903725,1249903726,1249903732,1249903720,1249903723,1249903724,1249903727,1249903728,1249903710,1249903713,1249903714,1249903716,1249903718,1249903715,1249903717,1249903719,1249903765,1249903766,1249903568...1249903571,1249903573,1249903576,1249903572,1249903574,1249903577,1249903685,1249903729,1249903748...1249903750,1249903756...1249903758,1249903575,1249903683,1249903686...1249903688,1249903690,1249903566,1249903759,1249903760,1249903762,1249903767,1249903578,1249903689,1249903691,1249903752,1249903755,1249903580,1249903581,1249903751,1249903753,1249903754,1249903555...1249903558,1249903761,1249903563,1249903565,1249903705,1249903706,1249903708,1249903579,1249903582...1249903587,1249903622,1249903684,1249903692,1249903560...1249903562,1249903567,1249903550...1249903554,1249903559,1249903618,1249903620,1249903623,1249903624,1249903588,1249903616,1249903739,1249903740,1249903742,1249903701,1249903702,1249903704,1249903709,1249903636...1249903638,1249903703,1249903707,1249903609,1249903617,1249903619,1249903621,1249903744,1249903741,1249903743,1249903745...1249903747,1249903610...1249903614,1249903625,1249903626,1249903628,1249903630,1249903631,1249903607,1249903608,1249903615,1249903669,1249903674,1249903627,1249903629,1249903651,1249903652,1249903656,1249903694,1249903696...1249903699,1249903632...1249903635,1249903639,1249903640,1249903693,1249903700,1249903606,1249903675,1249903676,1249903681,1249903682,1249903650,1249903653...1249903655,1249903647,1249903666,1249903667,1249903670...1249903672,1249903602...1249903605,1249903668,1249903677,1249903679,1249903680,1249903695,1249903643,1249903644,1249903649,1249903673,1249903589,1249903590,1249903597,1249903641,1249903648,1249903642,1249903645,1249903646,1249903678,1249903591,1249903598...1249903601,1249903592...1249903596,1249903564,1249903763,1249903764,1249903768,1249934348")
NOMIS_LSOA_EALING = ("1249903842,1249903844,1249903882...1249903884,1249903880,1249903881,1249903885...1249903891,1249903893,1249903894,1249903843,1249903892,1249903895,1249903896,1249903914...1249903916,1249903918,1249903838...1249903840,1249903845,1249903922,1249903917,1249903919...1249903921,1249903830,1249903897,1249903899,1249903903,1249903905,1249903898,1249903900...1249903902,1249903904,1249903831,1249903835...1249903837,1249934517,1249934518,1249903849...1249903851,1249903853,1249903792,1249903833,1249903834,1249903841,1249903783,1249903785,1249903852,1249903854,1249903791,1249903832,1249903864...1249903866,1249903770,1249903812,1249903813,1249903820,1249903821,1249903784,1249903855,1249903856,1249903858...1249903860,1249903867...1249903871,1249903778...1249903782,1249903786,1249903796,1249903798,1249903800...1249903802,1249903795,1249903797,1249903799,1249903809,1249903810,1249903846...1249903848,1249903769,1249903771...1249903773,1249903857,1249903861...1249903863,1249903787...1249903790,1249903934,1249903814...1249903819,1249903774...1249903777,1249903924,1249903932,1249903933,1249903935...1249903938,1249903805,1249903808,1249903923,1249903925,1249903927,1249903823,1249903824,1249903829,1249903955,1249903960,1249903961,1249903793,1249903794,1249903907,1249903910...1249903913,1249903825...1249903828,1249903803,1249903804,1249903806,1249903807,1249903811,1249903958,1249903876,1249903954,1249903956,1249903957,1249903959,1249903926,1249903928...1249903931,1249903948,1249903950,1249903951,1249903953,1249903822,1249903872,1249903878,1249903879,1249903939...1249903941,1249903943...1249903946,1249903906,1249903908,1249903909,1249903942,1249903873...1249903875,1249903877,1249903947,1249903949,1249903952,1249934351")
NOMIS_LSOA_ENFIELD = ("1249904015,1249904017,1249904116,1249904122,1249904014,1249904115,1249904117,1249904118,1249904121,1249904016,1249904018...1249904020,1249934888,1249934889,1249903980,1249903983...1249903986,1249903979,1249903981,1249903982,1249904086,1249904107,1249904011,1249904013,1249904087,1249904119,1249904120,1249904005...1249904008,1249904010,1249904040,1249904106,1249904110...1249904112,1249904108,1249904109,1249904113,1249904114,1249904028,1249904039,1249904042,1249904043,1249904045,1249903987,1249903989,1249903990,1249903994,1249904012,1249904074,1249904075,1249904077,1249904078,1249904083,1249903988,1249904041,1249904044,1249904046,1249904009,1249904076,1249904079,1249904080,1249903977,1249903978,1249904021,1249904082,1249904085,1249903973,1249904049,1249904055,1249904081,1249904084,1249904088,1249904022...1249904025,1249904047,1249904048,1249904052,1249904072,1249904073,1249904090,1249904092...1249904094,1249904096,1249903991...1249903993,1249904089,1249904095,1249903970...1249903972,1249903974,1249903975,1249904026,1249904027,1249904133,1249904136...1249904138,1249904050,1249904053,1249904058,1249904060,1249904061,1249904030,1249904031,1249904033,1249904051,1249904059,1249904054,1249904056,1249904057,1249904062,1249934887,1249934890,1249903976,1249904063,1249904064,1249904066,1249904139,1249903995,1249903997,1249904000,1249904032,1249904035,1249904091,1249904101...1249904103,1249904105,1249904065,1249904068,1249904132,1249904134,1249904135,1249903996,1249903998,1249903999,1249904001,1249904002,1249904034,1249904036...1249904038,1249904067,1249904069,1249903964,1249904098...1249904100,1249904104,1249904003,1249904004,1249904125,1249904127...1249904129,1249903966,1249903967,1249903969,1249904070,1249904126,1249904130,1249903962,1249903963,1249903965,1249903968,1249904071,1249904097,1249904029,1249904123,1249904124,1249904131,1249934353")
NOMIS_LSOA_GREENWICH = ("1249904247...1249904250,1249904245,1249904246,1249935407...1249935409,1249935411,1249935413,1249904144...1249904148,1249904264,1249904266,1249904267,1249935399,1249935402...1249935405,1249904261...1249904263,1249904265,1249904268,1249904230...1249904233,1249904235,1249904193,1249904194,1249904197,1249904198,1249935410,1249935412,1249904140...1249904143,1249904192,1249904195,1249904196,1249904199,1249904251...1249904253,1249904256,1249904259,1249904260,1249904157,1249904158,1249904160,1249904164,1249904159,1249904161...1249904163,1249904254,1249904255,1249904257,1249904258,1249904150,1249904154...1249904156,1249904236,1249904241...1249904243,1249904206,1249904210...1249904212,1249904237...1249904240,1249904244,1249904149,1249904151...1249904153,1249904205,1249904207...1249904209,1249904174,1249904175,1249904179,1249904180,1249904187...1249904191,1249904173,1249904176...1249904178,1249904181...1249904184,1249904213...1249904215,1249904220,1249904221,1249904185,1249904186,1249935397,1249904166,1249904167,1249904171,1249904172,1249904165,1249904168...1249904170,1249904228,1249904229,1249904234,1249934346,1249904216...1249904219,1249935394,1249904201,1249935395,1249935396,1249935398,1249904225...1249904227,1249935400,1249935401,1249904222...1249904224,1249935406,1249904200,1249904202...1249904204,1249935414")
NOMIS_LSOA_HACKNEY = ("1249904357,1249904358,1249904362,1249904369,1249904371,1249904269,1249904359,1249904361,1249935369,1249904348,1249904351,1249904353,1249904356,1249904360,1249904279,1249904280,1249904349,1249904370,1249904372,1249904277,1249904278,1249904281,1249904320,1249904321,1249904270...1249904275,1249904296,1249904350,1249904352,1249904355,1249904295,1249904354,1249904375,1249904377,1249904378,1249904317...1249904319,1249904322,1249935371,1249935381,1249904342...1249904346,1249904290...1249904293,1249904336...1249904338,1249904340,1249904294,1249904300,1249904376,1249904379...1249904381,1249904287,1249904335,1249904339,1249904341,1249904298,1249904299,1249904310...1249904312,1249904314,1249904285,1249904288,1249904313,1249904315,1249904392...1249904395,1249904283,1249904284,1249904286,1249904289,1249904384,1249904396,1249904301,1249904302,1249904316,1249904364,1249904365,1249904297,1249904303,1249904304,1249904309,1249935366...1249935368,1249935375,1249904382,1249904386,1249904387,1249904390,1249904391,1249904383,1249904385,1249904388,1249904389,1249935372,1249935380,1249904323,1249904325,1249904326,1249904363,1249904366,1249904367,1249904305...1249904308,1249904324,1249904327,1249904329,1249904331...1249904333,1249904328,1249904330,1249904334,1249935374,1249935376,1249935377,1249935379,1249904347,1249904374,1249935370,1249935373,1249935378,1249904276,1249904282,1249904368,1249904373")
NOMIS_LSOA_HAMMERSMITH_AND_FULHAM = ("1249904420...1249904424,1249904500,1249904502,1249904503,1249904506,1249904499,1249904501,1249904504,1249904505,1249904488...1249904491,1249904408,1249904485...1249904487,1249904404,1249904406,1249904407,1249904409,1249904410,1249904398...1249904400,1249904403,1249904405,1249904411,1249904473,1249904476,1249904441...1249904443,1249904475,1249904397,1249904401,1249904402,1249904415,1249904419,1249904474,1249904477...1249904479,1249904412...1249904414,1249904416...1249904418,1249904439,1249904440,1249904444...1249904446,1249904435,1249904456,1249904459,1249904460,1249904431,1249904454,1249904455,1249904457,1249904458,1249904432,1249904433,1249904436,1249904438,1249904426...1249904430,1249904434,1249904437,1249904463...1249904465,1249904425,1249904447...1249904449,1249904466...1249904470,1249904492...1249904496,1249904498,1249904450...1249904453,1249904481,1249904484,1249934555...1249934557,1249904461,1249904462,1249904472,1249904497,1249904471,1249904480,1249904482,1249904483")
NOMIS_LSOA_HARINGEY = ("1249904514,1249904516,1249904519,1249904520,1249904579,1249904580,1249904582,1249904583,1249904507,1249904515,1249904517,1249904518,1249904633,1249904636,1249904639,1249904640,1249904634,1249904635,1249904637,1249904638,1249904641,1249904644,1249904645,1249904648,1249904642,1249904643,1249904646,1249904647,1249904508...1249904511,1249904571,1249904572,1249904576,1249904577,1249904521...1249904524,1249904617,1249904620,1249904622,1249904624,1249904625,1249904629,1249904631,1249904632,1249904512,1249904513,1249904541,1249904542,1249904618,1249904619,1249904621,1249904623,1249904570,1249904573...1249904575,1249904536...1249904538,1249904540,1249904525...1249904528,1249904626...1249904628,1249904630,1249904558,1249904559,1249904562,1249934828,1249934829,1249904564,1249904566,1249904567,1249904569,1249904557,1249904563,1249904565,1249904568,1249904543,1249904544,1249904548,1249904549,1249904610,1249904612,1249904613,1249904616,1249904609,1249904611,1249904614,1249904615,1249904586,1249904588,1249904589,1249904592,1249904585,1249904587,1249904590,1249904591,1249904560,1249904561,1249904602,1249904603,1249904593...1249904595,1249904598,1249904539,1249904553,1249904555,1249904556,1249904545...1249904547,1249904601,1249904596,1249904597,1249904599,1249904600,1249904529,1249904530,1249904532,1249904534,1249904531,1249904533,1249904535,1249904605,1249904550...1249904552,1249904554,1249904604,1249904606...1249904608,1249904578,1249904581,1249904584,1249934354")
NOMIS_LSOA_HARROW = ("1249904655,1249904657,1249904767,1249904768,1249904656,1249904658...1249904661,1249904769...1249904772,1249904687,1249904689,1249904690,1249904692,1249904683...1249904686,1249904688,1249904682,1249904691,1249904693...1249904695,1249904662...1249904666,1249904649,1249904651...1249904654,1249904728...1249904730,1249904733,1249904667,1249904668,1249904741,1249904743,1249904746,1249904774...1249904778,1249904650,1249904740,1249904742,1249904744,1249904745,1249904722,1249904723,1249904726,1249904727,1249904773,1249904697,1249904699,1249904705,1249904706,1249904731,1249904732,1249904735,1249904736,1249904708...1249904712,1249904696,1249904698,1249904700,1249904701,1249904671,1249904673,1249904724,1249904725,1249904702...1249904704,1249904707,1249904734,1249904737...1249904739,1249904669,1249904670,1249904672,1249904674,1249904779,1249904780,1249904782,1249904784,1249904750,1249904751,1249904781,1249904783,1249904676,1249904679,1249904681,1249904755,1249904753,1249904754,1249904758,1249904759,1249904675,1249904677,1249904678,1249904680,1249904760,1249904761,1249904763,1249904764,1249904756,1249904757,1249904762,1249904765,1249904766,1249904747...1249904749,1249904752,1249934355,1249904713...1249904721")
NOMIS_LSOA_HAVERING = ("1249904818,1249904820,1249904854,1249904855,1249904819,1249904821,1249904823,1249904825,1249904841,1249904843,1249904845,1249904846,1249904848,1249904849,1249904822,1249904824,1249904826,1249904839,1249904856,1249904858,1249904844,1249904847,1249904850,1249904868,1249904873,1249904851...1249904853,1249904857,1249904835,1249904836,1249904838,1249904840,1249904842,1249904875,1249904876,1249904878,1249904881,1249904883,1249904869,1249904870,1249904874,1249904877,1249904880,1249904882,1249904810,1249904811,1249904837,1249904918,1249904919,1249904924,1249904786,1249904787,1249904867,1249904871,1249904872,1249904879,1249904896,1249904917,1249904920...1249904922,1249904785,1249904895,1249904898,1249934515,1249934516,1249904814,1249904816,1249904859,1249904860,1249904897,1249904923,1249904812,1249904813,1249904815,1249904817,1249904861,1249904892...1249904894,1249904899,1249904788...1249904794,1249904798,1249904800,1249904801,1249904932,1249904795,1249904796,1249904799,1249904925,1249904900...1249904902,1249904904,1249904908,1249904862...1249904866,1249904797,1249904831,1249904834,1249904903,1249904927,1249904829,1249904833,1249904905...1249904907,1249904926,1249904928...1249904931,1249904807,1249904827,1249904828,1249904830,1249904832,1249904802...1249904806,1249904808,1249904809,1249904913...1249904915,1249904909...1249904912,1249904916,1249904885,1249904886,1249904890,1249904891,1249904884,1249904887...1249904889")
NOMIS_LSOA_HILLINGDON = ("1249905014,1249905016...1249905018,1249905023,1249905013,1249905015,1249905019,1249905024...1249905026,1249904979...1249904983,1249904974,1249904977,1249905020...1249905022,1249905069,1249905070,1249905074,1249905075,1249904959,1249904960,1249904972,1249904973,1249904978,1249904971,1249904975,1249904976,1249905011,1249905071,1249904957,1249904958,1249904961,1249904962,1249905012,1249905006,1249905008,1249905035,1249905072,1249905073,1249904956,1249905007,1249905009,1249905010,1249905036,1249904999...1249905001,1249905003,1249905005,1249905002,1249905004,1249905051,1249905052,1249905055,1249904991...1249904995,1249904955,1249905053,1249905054,1249935393,1249905058...1249905060,1249935392,1249904951,1249904953,1249904997,1249905049,1249905050,1249904963...1249904966,1249904968,1249904969,1249904949,1249904950,1249904970,1249904996,1249904998,1249904933,1249904934,1249905076,1249905078,1249905079,1249904935,1249904936,1249904938...1249904940,1249904967,1249904952,1249904954,1249905056,1249905057,1249905086,1249905090,1249905077,1249905080...1249905083,1249904941...1249904945,1249905084,1249905085,1249905087...1249905089,1249904937,1249905041,1249905042,1249905045,1249905048,1249904946,1249904947,1249905043,1249905044,1249905046,1249905047,1249905027,1249905028,1249905062,1249905064,1249905068,1249904986,1249905061,1249905065...1249905067,1249904948,1249905029...1249905031,1249905033,1249904985,1249904987,1249904988,1249905063,1249904984,1249904989,1249904990,1249905032,1249905034,1249905037...1249905040,1249934356")
NOMIS_LSOA_HOUNSLOW = ("1249905105,1249905106,1249905109...1249905111,1249905098,1249905100,1249905102,1249905104,1249934824,1249934825,1249905155,1249905160...1249905162,1249905166,1249905168,1249905169,1249905172,1249905173,1249905099,1249905101,1249905103,1249905218,1249905219,1249905107,1249905108,1249905113,1249905114,1249905221,1249905222,1249905112,1249905115...1249905118,1249905209,1249905212...1249905214,1249905154,1249905157,1249905167,1249905170,1249905171,1249905153,1249905156,1249905158,1249905163...1249905165,1249905174,1249905175,1249905208,1249905210,1249905119...1249905122,1249905125,1249905202,1249905203,1249905215...1249905217,1249905177...1249905179,1249905192,1249905211,1249905123,1249905124,1249905194,1249905195,1249905199,1249905159,1249905180,1249905196...1249905198,1249905176,1249905182,1249905183,1249905191,1249934826,1249934827,1249905187...1249905190,1249905193,1249905201,1249905204...1249905207,1249905181,1249905184...1249905186,1249905200,1249905091,1249905092,1249905126,1249905128,1249905131,1249905093...1249905097,1249905127,1249905129,1249905130,1249905146...1249905148,1249905133...1249905135,1249905138,1249934751,1249934773,1249905139...1249905142,1249905150,1249905132,1249905136,1249905137,1249905149,1249905151,1249905143...1249905145,1249905152,1249905220,1249905223...1249905225,1249934352")
NOMIS_LSOA_ISLINGTON = ("1249905284,1249905285,1249905287,1249905332,1249905335,1249905339,1249905282,1249905283,1249905286,1249905288,1249905289,1249905300,1249905266,1249905333,1249905334,1249905336...1249905338,1249905296,1249905298,1249905299,1249905301,1249905302,1249905263,1249905265,1249905267,1249905268,1249905280,1249905273,1249905277...1249905279,1249935179,1249935180,1249905261,1249905262,1249905264,1249905291,1249905297,1249905313,1249905316,1249905317,1249905269,1249905272,1249905274,1249905275,1249905281,1249905292,1249905311,1249905312,1249905314,1249905315,1249905290,1249905295,1249935172...1249935174,1249935177,1249935178,1249905305...1249905307,1249905309,1249905310,1249905270,1249905271,1249905276,1249905323,1249905324,1249905247,1249905249,1249905252,1249905303,1249905304,1249905308,1249905239,1249905243,1249905244,1249905293,1249905294,1249905248,1249905250,1249905251,1249905318,1249905319,1249905321,1249905230...1249905232,1249905245,1249905320,1249905253,1249905325...1249905328,1249905226,1249905229,1249905240,1249905241,1249905246,1249905228,1249905322,1249905329...1249905331,1249905227,1249905242,1249905258...1249905260,1249905238,1249905254...1249905257,1249935175,1249935176,1249905233...1249905237")
NOMIS_LSOA_KENSINGTON_AND_CHELSEA = ("1249905380...1249905383,1249905385,1249905432...1249905435,1249905404...1249905406,1249905436,1249905437,1249905357...1249905360,1249905384,1249905398,1249905400,1249905407...1249905414,1249905361,1249905399,1249905401...1249905403,1249905352...1249905356,1249905392,1249905394...1249905397,1249905415,1249905417...1249905420,1249905341,1249905343...1249905345,1249905393,1249905346,1249905347,1249905387,1249905388,1249905391,1249905340,1249905362,1249905367,1249905378,1249905416,1249905349,1249905351,1249905386,1249905389,1249905390,1249905342,1249905375,1249905376,1249905379,1249905348,1249905350,1249905363...1249905365,1249905374,1249905377,1249905421,1249905422,1249905426...1249905431,1249905372,1249905373,1249905438,1249905439,1249905442,1249905366,1249905423...1249905425,1249905440,1249905368...1249905371,1249905441")
NOMIS_LSOA_KINGSTON_UPON_THAMES = ("1249905533...1249905537,1249905479,1249905480,1249905482,1249905483,1249905486,1249905463,1249905465,1249905478,1249905481,1249905484,1249905461,1249905462,1249905464,1249905538,1249935236,1249935237,1249905491,1249905496,1249905498,1249905499,1249905501,1249905460,1249905487,1249905489,1249905497,1249905500,1249905457...1249905459,1249905490,1249905512,1249905455,1249905456,1249905485,1249905488,1249905513,1249905492,1249905494,1249905495,1249905517,1249905518,1249905450,1249905454,1249905493,1249905519,1249905449,1249905514...1249905516,1249905502,1249905504,1249905507,1249905508,1249905511,1249905451,1249905453,1249905520,1249905522,1249905526,1249905443...1249905445,1249905448,1249905452,1249905503,1249905505,1249905506,1249905509,1249905510,1249905521,1249905523...1249905525,1249905529,1249905446,1249905447,1249905527,1249905528,1249905530,1249905466,1249905468,1249905469,1249905531,1249905532,1249905471...1249905474,1249905467,1249905470,1249905475...1249905477")
NOMIS_LSOA_LAMBETH = ("1249905541,1249905633,1249905635...1249905637,1249905627,1249905630...1249905632,1249905634,1249905628,1249905629,1249905647,1249905654,1249934937,1249934938,1249905624...1249905626,1249905705,1249905708,1249905623,1249905646,1249905648...1249905650,1249905706,1249905709...1249905712,1249905615,1249905617,1249905618,1249905651,1249905653,1249905572,1249905574,1249905601,1249905707,1249905713,1249905614,1249905619,1249905620,1249905622,1249905652,1249905571,1249905573,1249905575,1249905585...1249905587,1249905560...1249905562,1249905616,1249905621,1249905563...1249905566,1249905568,1249905598,1249905599,1249905602...1249905604,1249905545,1249905579,1249905580,1249905582,1249905584,1249905546,1249905576,1249905578,1249905581,1249905701,1249905555,1249905558,1249905567,1249905583,1249905569,1249905570,1249905577,1249905597,1249905600,1249905552...1249905554,1249905556,1249905559,1249905544,1249905696,1249905698,1249905702,1249905703,1249905547...1249905551,1249905661,1249905662,1249905684,1249905685,1249905687,1249905557,1249905681...1249905683,1249905686,1249905688,1249905657,1249905697,1249905699,1249905700,1249905704,1249905689,1249905690,1249905693...1249905695,1249905655,1249905656,1249905660,1249905663,1249905676,1249905605,1249905606,1249905658,1249905659,1249905677,1249905590,1249905592,1249905607,1249905691,1249905692,1249905641...1249905643,1249905678,1249905680,1249905609...1249905611,1249905674,1249905679,1249905591,1249905594,1249905608,1249905612,1249905613,1249905638,1249905639,1249905644,1249905645,1249905673,1249905675,1249905588,1249905589,1249905593,1249905595,1249905596,1249905640,1249905666,1249905669,1249905670,1249905672,1249905664,1249905665,1249905667,1249905668,1249905671,1249905539,1249905540,1249905542,1249905543,1249934360")
NOMIS_LSOA_LEWISHAM = ("1249905766,1249905767,1249905769,1249905771,1249905772,1249905768,1249905770,1249905773...1249905775,1249905817,1249905819,1249905821,1249905822,1249905825,1249905732...1249905734,1249905736,1249905739,1249905857...1249905860,1249905862,1249905724,1249905726,1249905729...1249905731,1249905735,1249905737,1249905738,1249935033,1249935034,1249905723,1249905725,1249905727,1249905728,1249905855,1249905856,1249905861,1249905863,1249905864,1249905795,1249905799...1249905801,1249905810...1249905812,1249905816,1249935035,1249935045,1249905804...1249905806,1249905808,1249905794,1249905796...1249905798,1249905749,1249905755...1249905757,1249905802,1249905803,1249905807,1249905809,1249905813...1249905815,1249935031,1249935032,1249905838,1249905839,1249905842,1249905844,1249905750...1249905754,1249905836,1249905837,1249905840,1249905841,1249905843,1249905776,1249905777,1249905782...1249905784,1249905741,1249905742,1249905744,1249905746,1249905748,1249905785,1249905790...1249905793,1249905826,1249905827,1249905833...1249905835,1249905740,1249905743,1249905745,1249905747,1249905865,1249905868,1249905870,1249905873,1249905828...1249905832,1249905778...1249905781,1249905718...1249905722,1249905866,1249905867,1249905869,1249905871,1249905872,1249905786...1249905789,1249905848...1249905851,1249905853,1249905714...1249905717,1249905845...1249905847,1249905852,1249905854,1249905759...1249905762,1249934343,1249905758,1249905763...1249905765,1249934344,1249905818,1249905820,1249905823,1249905824,1249934357")
NOMIS_LSOA_MERTON = ("1249905991...1249905994,1249905997,1249905979,1249905981,1249905983,1249905984,1249905919,1249905973,1249905975,1249905995,1249905996,1249905920...1249905923,1249905980,1249905886,1249905888...1249905890,1249905974,1249905878,1249905879,1249905976...1249905978,1249905913...1249905917,1249905887,1249905891,1249905912,1249905925,1249905926,1249905874,1249905875,1249905877,1249905902,1249905903,1249905961...1249905964,1249905982,1249905899,1249905901,1249905904,1249905918,1249905942,1249905876,1249905895,1249905896,1249905927,1249905929,1249905905,1249905907,1249905908,1249905911,1249905928,1249905906,1249905910,1249905930,1249905931,1249905954,1249905880,1249905943...1249905945,1249905947,1249905885,1249905900,1249905965,1249905966,1249905990,1249905932...1249905935,1249905953,1249905892,1249905897,1249905898,1249905909,1249905924,1249905948...1249905952,1249905985...1249905989,1249905881...1249905884,1249905940,1249905893,1249905894,1249905956,1249905959,1249905960,1249905946,1249905955,1249905958,1249905967,1249905972,1249905957,1249905968...1249905971,1249905936...1249905939,1249905941")
NOMIS_LSOA_NEWHAM = ("1249906059,1249906060,1249906062,1249906066,1249906092,1249906097...1249906099,1249906094,1249906100,1249906102,1249906106,1249906095,1249906101,1249906103,1249906107,1249906044,1249906091,1249906093,1249906096,1249906061,1249906064,1249906065,1249906073,1249906063,1249906071,1249906077,1249906083,1249906072,1249906074,1249906086...1249906088,1249906067,1249906069,1249906070,1249906075,1249906045...1249906048,1249906050,1249906049,1249906076,1249906079,1249906104,1249906105,1249906128...1249906131,1249906127,1249935246,1249935247,1249935251,1249935254,1249906078,1249906080...1249906082,1249906136...1249906140,1249906068,1249906112,1249906113,1249906146,1249906084,1249906085,1249906089,1249906090,1249906036...1249906038,1249906041,1249906042,1249906007...1249906009,1249906040,1249906142...1249906145,1249906147,1249906114,1249906116,1249906141,1249906148,1249906010,1249906108,1249906115,1249906122,1249906051,1249906052,1249906132...1249906134,1249906039,1249906043,1249906053,1249906058,1249906135,1249906011...1249906014,1249906110,1249906111,1249906118,1249906123,1249906015,1249906017,1249906019,1249906109,1249906117,1249906119,1249906121,1249906124,1249906054...1249906057,1249906018,1249906020...1249906022,1249906024...1249906026,1249906120,1249906002,1249906003,1249906032,1249906034,1249906035,1249905999,1249906001,1249906005,1249906006,1249906016,1249906023,1249935242...1249935244,1249935252,1249935253,1249905998,1249906000,1249906004,1249906029,1249906027,1249906028,1249906030,1249906031,1249906033,1249906125,1249906126,1249935245,1249935248...1249935250")
NOMIS_LSOA_REDBRIDGE = ("1249906252...1249906258,1249906228,1249906230,1249906231,1249906234,1249906229,1249906232,1249906233,1249906235,1249906165,1249906166,1249906169,1249906171,1249906167,1249906168,1249906170,1249906207...1249906213,1249906178...1249906184,1249906216...1249906219,1249906267...1249906273,1249906214,1249906215,1249906220,1249906221,1249906157,1249906159,1249906160,1249906162,1249906150...1249906153,1249906282...1249906288,1249906158,1249906161,1249906163,1249906164,1249906149,1249906154...1249906156,1249906297,1249906302...1249906304,1249906172...1249906177,1249935258,1249935260,1249906259,1249906261,1249906262,1249906265,1249906277...1249906279,1249906281,1249906260,1249906263,1249906264,1249906266,1249906274...1249906276,1249906280,1249906289,1249906290,1249906294,1249906295,1249906298...1249906301,1249906291...1249906293,1249906296,1249906193...1249906198,1249935257,1249935259,1249906245...1249906251,1249906236...1249906238,1249906240,1249906241,1249906239,1249906242...1249906244,1249906222...1249906227,1249934359,1249906199...1249906206,1249906185...1249906192")
NOMIS_LSOA_RICHMOND_UPON_THAMES = ("1249906305...1249906311,1249906354,1249906355,1249906357,1249906358,1249906367,1249906371,1249906359...1249906365,1249906356,1249906368...1249906370,1249906372,1249935238,1249935239,1249906312,1249906315...1249906317,1249906366,1249906380...1249906382,1249906385,1249906373,1249906375,1249906378,1249906379,1249906329,1249906383,1249906384,1249906386,1249906399...1249906402,1249906412...1249906416,1249906374,1249906376,1249906377,1249906417,1249906313,1249906314,1249906324,1249906325,1249906348...1249906353,1249906389,1249906390,1249906403...1249906411,1249906387,1249906388,1249906391,1249906392,1249906326...1249906328,1249906319,1249906320,1249906397,1249906398,1249906318,1249906321...1249906323,1249906336...1249906341,1249906393...1249906396,1249906342...1249906347,1249906330...1249906335")
NOMIS_LSOA_SOUTHWARK = ("1249906524,1249906527,1249906548...1249906550,1249906434,1249906435,1249906439,1249906440,1249906444,1249906477,1249906522,1249934415,1249934416,1249934418,1249934424,1249934566,1249934595,1249906476,1249906479,1249906519,1249906520,1249906523,1249906443,1249906445...1249906447,1249906480,1249906482,1249906525,1249906526,1249906528,1249906529,1249906531,1249906551...1249906555,1249906441,1249906442,1249906448,1249934497,1249906478,1249906532,1249906533,1249906537,1249906538,1249906485,1249906486,1249906521,1249906530,1249906463,1249906464,1249906493,1249934498,1249906481,1249906534...1249906536,1249906539,1249906491,1249906494,1249906496,1249906497,1249934417,1249934496,1249906466,1249906467,1249906469,1249906472,1249906475,1249906465,1249906468,1249906471,1249906473,1249906474,1249906430,1249906470,1249906490,1249906492,1249906495,1249906483,1249906487...1249906489,1249906505,1249906419,1249906508...1249906511,1249906418,1249906423...1249906425,1249906432,1249906426...1249906429,1249906431,1249906433,1249906506,1249906507,1249906562,1249934567,1249906484,1249906501...1249906504,1249906420...1249906422,1249906545,1249906547,1249906556...1249906558,1249906560,1249906561,1249906498,1249906499,1249906516,1249906559,1249906563,1249906540,1249906542...1249906544,1249906546,1249906457,1249906459,1249906512,1249906518,1249906541,1249906500,1249906513,1249906514,1249906517,1249906456,1249906458,1249906460,1249906566,1249906567,1249906564,1249906565,1249906568...1249906570,1249906453,1249906454,1249906461,1249906462,1249906515,1249906449...1249906452,1249906455,1249906436...1249906438,1249934361,1249934362")
NOMIS_LSOA_SUTTON = ("1249906619,1249906677...1249906679,1249906683,1249906617,1249906618,1249906620,1249906622...1249906625,1249906628...1249906630,1249906658,1249906660,1249906663,1249906680,1249906682,1249906621,1249906657,1249906659,1249906661,1249906681,1249906611,1249906615,1249906686,1249906687,1249906689,1249906638...1249906641,1249906610,1249906616,1249906684,1249906685,1249906688,1249906690,1249906609,1249906612,1249906613,1249906626,1249906627,1249906665...1249906667,1249906669,1249906670,1249906571...1249906577,1249906631,1249906634...1249906636,1249906643,1249906596,1249906598,1249906632,1249906633,1249906662,1249906637,1249906642,1249906653...1249906655,1249906592...1249906595,1249906597,1249906605...1249906607,1249906614,1249906651,1249906582,1249906664,1249906668,1249906672,1249906673,1249906646,1249906649,1249906650,1249906652,1249906656,1249906578,1249906581,1249906583,1249906584,1249906676,1249906599,1249906602,1249906671,1249906674,1249906675,1249906585,1249906591,1249906644,1249906645,1249906647,1249906586,1249906587,1249906600,1249906601,1249906648,1249906579,1249906580,1249906603,1249906604,1249906588...1249906590,1249906608,1249934401")
NOMIS_LSOA_TOWER_HAMLETS = ("1249906713...1249906715,1249906717,1249906691...1249906693,1249906695,1249906718,1249906720,1249906722...1249906724,1249906716,1249906719,1249906721,1249934531,1249934532,1249934551,1249906694,1249906696...1249906698,1249906796,1249906799,1249906800,1249906803,1249906749,1249906750,1249906753,1249906755,1249906725...1249906729,1249906797,1249906798,1249906801,1249906802,1249906751,1249906752,1249906754,1249934552,1249934553,1249906701,1249906703,1249906705,1249934554,1249906730...1249906732,1249906756,1249906757,1249906699,1249906700,1249906702,1249906704,1249906758...1249906762,1249906791...1249906795,1249906769,1249906773,1249906775,1249906776,1249906806...1249906808,1249906810,1249906735,1249906736,1249906738,1249906739,1249906770...1249906772,1249906774,1249906733,1249906734,1249906737,1249906740,1249906804,1249906805,1249906809,1249934533,1249934534,1249906784,1249906785,1249906789,1249906790,1249906741,1249906744,1249906745,1249906748,1249906742,1249906743,1249906746,1249906747,1249906786...1249906788,1249934535,1249934536,1249906778,1249906780...1249906782,1249906777,1249906779,1249906783,1249906707,1249906711,1249906712,1249934543...1249934547,1249906706,1249906708...1249906710,1249906763...1249906765,1249906768,1249934542,1249934550,1249906767,1249934537,1249934539...1249934541,1249906766,1249934538,1249934548,1249934549")
NOMIS_LSOA_WALTHAM_FOREST = ("1249906833...1249906835,1249906840,1249906841,1249906836...1249906838,1249906842,1249906843,1249906868...1249906870,1249906873,1249906874,1249906839,1249906844,1249906897,1249906899,1249906900,1249906845,1249906898,1249906901,1249906933,1249906934,1249906932,1249906935...1249906938,1249906863...1249906865,1249906867,1249906871,1249906872,1249906827,1249906828,1249906866,1249906902,1249906903,1249906882...1249906884,1249906886,1249906887,1249906829,1249906832,1249906861,1249906862,1249906826,1249906830,1249906831,1249906942,1249906944,1249906880,1249906939...1249906941,1249906945,1249906891,1249906894,1249906946,1249906951...1249906953,1249906875,1249906877,1249906885,1249906888,1249906943,1249906896,1249906947...1249906950,1249906890,1249906892,1249906893,1249906895,1249906925,1249906929,1249906876,1249906878,1249906881,1249906926,1249906928,1249906879,1249906905,1249906927,1249906930,1249906931,1249906847,1249906848,1249906850...1249906852,1249906849,1249906889,1249906904,1249906907,1249934891,1249906846,1249906918,1249906919,1249906921,1249906924,1249906906,1249906908...1249906911,1249906853,1249906854,1249906856,1249906915,1249906917,1249906817,1249906818,1249906920,1249906922,1249906923,1249906855,1249906857...1249906860,1249906820,1249906912...1249906914,1249906916,1249906819,1249906821...1249906825,1249906811...1249906816")
NOMIS_LSOA_WANDSWORTH = ("1249907042,1249907047,1249907062,1249907063,1249907043...1249907045,1249907048,1249934841,1249934843,1249934875,1249907021,1249907022,1249907058,1249907064,1249907059...1249907061,1249934842,1249934844,1249934876,1249907046,1249907070...1249907072,1249907083...1249907087,1249907017,1249907019,1249907020,1249907023,1249907016,1249907018,1249907034,1249907065,1249907068,1249907036,1249907038,1249907066,1249907067,1249907069,1249906991,1249906993,1249907082,1249907088,1249934836,1249934877,1249906988,1249907117...1249907120,1249906990,1249906992,1249906996,1249906997,1249907033,1249907049,1249907055...1249907057,1249906982,1249906983,1249906985,1249906987,1249906989,1249907035,1249907039...1249907041,1249907098,1249907053,1249907121...1249907124,1249906959...1249906961,1249907032,1249907037,1249906976,1249906995,1249907080,1249907081,1249906975,1249906994,1249907099,1249907100,1249907102,1249907106,1249906981,1249906984,1249906986,1249907074,1249907076,1249907108,1249906954,1249906956,1249906958,1249907024,1249907026,1249907107,1249907109,1249907110,1249907112,1249907050...1249907052,1249907054,1249906977...1249906979,1249907101,1249907103,1249907073,1249907075,1249907077...1249907079,1249906955,1249906957,1249906962,1249906965,1249906966,1249906968,1249907025,1249907027,1249907028,1249907031,1249907104,1249907105,1249907111,1249907113...1249907116,1249906963,1249906970,1249907029,1249907030,1249906964,1249906967,1249906969,1249906971...1249906974,1249906980,1249907014,1249907090,1249907091,1249907097,1249907013,1249907015,1249907089,1249907092...1249907096,1249907007...1249907012,1249906998,1249907000...1249907002,1249907005,1249906999,1249907003,1249907004,1249907006")
NOMIS_LSOA_WESTMINSTER = ("1249907126,1249907128,1249907196,1249907202,1249907125,1249907127,1249907129,1249907182,1249907183,1249907130,1249907197,1249907198,1249907200,1249907201,1249907190...1249907194,1249907148,1249907149,1249907151...1249907153,1249907195,1249907150,1249907178...1249907180,1249907228,1249907174,1249907176,1249907177,1249907181,1249935268,1249935276,1249907137,1249907138,1249907184,1249907199,1249907147,1249907175,1249935266,1249935269...1249935273,1249907226,1249907227,1249907229,1249934294,1249934295,1249907185,1249907186,1249907188,1249907189,1249907232,1249907135,1249907136,1249907139...1249907141,1249907187,1249907233,1249907234,1249935263,1249935264,1249907132...1249907134,1249907230,1249935274,1249935275,1249907154,1249907157...1249907159,1249935261,1249935262,1249907155,1249907156,1249907167,1249907170,1249907173,1249907131,1249907166,1249907168,1249907169,1249907171,1249907172,1249907206...1249907208,1249907231,1249907160...1249907165,1249907203...1249907205,1249907216,1249907220,1249907212,1249907215,1249907217...1249907219,1249907214,1249907221,1249907223...1249907225,1249907143...1249907145,1249907222,1249935265,1249935267,1249907142,1249907146,1249907209...1249907211,1249907213")


NOMIS_LSOA_GREATER_LONDON = [NOMIS_LSOA_BARKING_AND_DAGENHAM,NOMIS_LSOA_BERNET,NOMIS_LSOA_BEXLEY,NOMIS_LSOA_BRENT,
                             NOMIS_LSOA_BROMLEY,NOMIS_LSOA_CAMDEN,NOMIS_LSOA_CITY_OF_LONDON,NOMIS_LSOA_CROYDON,
                             NOMIS_LSOA_EALING,NOMIS_LSOA_ENFIELD,NOMIS_LSOA_GREENWICH,NOMIS_LSOA_HACKNEY,
                             NOMIS_LSOA_HAMMERSMITH_AND_FULHAM,NOMIS_LSOA_HARINGEY,NOMIS_LSOA_HARROW,NOMIS_LSOA_HAVERING,
                             NOMIS_LSOA_HILLINGDON,NOMIS_LSOA_HOUNSLOW,NOMIS_LSOA_ISLINGTON,NOMIS_LSOA_KENSINGTON_AND_CHELSEA,
                             NOMIS_LSOA_KINGSTON_UPON_THAMES,NOMIS_LSOA_LAMBETH,NOMIS_LSOA_LEWISHAM,NOMIS_LSOA_MERTON,
                             NOMIS_LSOA_NEWHAM,NOMIS_LSOA_REDBRIDGE,NOMIS_LSOA_RICHMOND_UPON_THAMES,NOMIS_LSOA_SOUTHWARK,
                             NOMIS_LSOA_SUTTON,NOMIS_LSOA_TOWER_HAMLETS,NOMIS_LSOA_WALTHAM_FOREST,NOMIS_LSOA_WANDSWORTH,
                             NOMIS_LSOA_WESTMINSTER]


LONDON_BOROUGHS = ["Westminster", "Kensington and Chelsea", "City of London"
                   "Hammersmith and Fulham", "Wandsworth", "Lambeth", "Southwark", "Tower Hamlets",
                   "Hackney", "Islington", "Camden", "Brent", "Ealing", "Hounslow",
                   "Richmond upon Thames", "Kingston upon Thames", "Merton", "Sutton", "Croydon",
                   "Bromley", "Lewisham", "Greenwich", "Bexley", "Havering", "Barking and Dagenham",
                   "Redbridge", "Newham", "Waltham Forest", "Haringey", "Enfield", "Barnet",
                   "Harrow", "Hillingdon"]
NOMIS_GEOGRAPHY_CODE_COLUMN_NAME = "GEOGRAPHY_CODE"
NOMIS_VALUE_NAME_COLUMN_NAME = "CELL_NAME"
NOMIS_VALUE_COLUMN_NAME = "OBS_VALUE"

LONDON_BOUNDARY_FILE_URL = ('https://files.datapress.com/london/dataset/statistical-gis-boundary-'
                            'files-london/2016-10-03T13:52:28/statistical-gis-boundaries-'
                            'london.zip')
WARD_SHAPE_FILE_PATH = Path('./statistical-gis-boundaries-london/ESRI/London_Ward.shp')
MSOA_SHAPE_FILE_PATH = Path('./statistical-gis-boundaries-london/ESRI/MSOA_2011_London_gen_MHW.shp')
LSOA_SHAPE_FILE_PATH = Path('./statistical-gis-boundaries-london/ESRI/LSOA_2011_London_gen_MHW.shp')
OA_SHAPE_FILE_PATH = Path('./statistical-gis-boundaries-london/ESRI/OA_2011_London_gen_MHW.shp')
BOROUGH_ID_IN_WARD_DATA_SET = 'BOROUGH'
BOROUGH_ID_COLUMN_NAME = 'LAD11NM'
WARD_ID_COLUMN_NAME = 'GSS_CODE'
MSOA_ID_COLUMN_NAME = 'MSOA11CD'
LSOA_ID_COLUMN_NAME = 'LSOA11CD'
OA_ID_COLUMN_NAME = 'OA11CD'


class GeographicalLayer(Enum):
    """The geographical layer at which census data should be retrieved."""
    OA = (OA_SHAPE_FILE_PATH, BOROUGH_ID_COLUMN_NAME, OA_ID_COLUMN_NAME)
    LSOA = (LSOA_SHAPE_FILE_PATH, BOROUGH_ID_COLUMN_NAME, LSOA_ID_COLUMN_NAME)
    MSOA = (MSOA_SHAPE_FILE_PATH, BOROUGH_ID_COLUMN_NAME, MSOA_ID_COLUMN_NAME)
    WARD = (WARD_SHAPE_FILE_PATH, BOROUGH_ID_IN_WARD_DATA_SET, WARD_ID_COLUMN_NAME)

    def __init__(self, shape_file_path, borough_col_name, index_col_name):
        self.shape_file_path = shape_file_path
        self.borough_col_name = borough_col_name
        self.index_col_name = index_col_name


class StudyArea(Enum):
    """The study area inside of Greater London for which census data should be retrieved.

    A study area comprises of one or more boroughs.
    """
    HARINGEY = (['Haringey'], 101955, 254926, NOMIS_OA_HARINGEY, NOMIS_LSOA_HARINGEY,
                NOMIS_MSOA_HARINGEY, NOMIS_WARD_HARINGEY)
    GREATER_LONDON = (LONDON_BOROUGHS, 3266173, 8173941, None, NOMIS_LSOA_GREATER_LONDON,
                      NOMIS_MSOA_GREATER_LONDON, NOMIS_WARD_GREATER_LONDON)

    def __init__(self, borough_names, number_households, number_usual_residents,
                 nomis_oa_geo_codes, nomis_lsoa_geo_codes,
                 nomis_msoa_geo_codes, nomis_ward_geo_codes):
        self.borough_names = borough_names
        self.number_households = number_households
        self.number_usual_residents = number_usual_residents
        self._nomis_geo_codes = {
            GeographicalLayer.OA: nomis_oa_geo_codes,
            GeographicalLayer.LSOA: nomis_lsoa_geo_codes,
            GeographicalLayer.MSOA: nomis_msoa_geo_codes,
            GeographicalLayer.WARD: nomis_ward_geo_codes
        }

    def nomis_geo_codes(self, geographical_layer):
        if self == StudyArea.GREATER_LONDON and (geographical_layer == GeographicalLayer.OA):
            raise ValueError("OA level not supported for Greater London.")
        else:
            return self._nomis_geo_codes[geographical_layer]


AGE_STRUCTURE_MAP = {
    "Age 0 to 4": AgeStructure.AGE_0_TO_4,
    "Age 5 to 7": AgeStructure.AGE_5_TO_7,
    "Age 8 to 9": AgeStructure.AGE_8_TO_9,
    "Age 10 to 14": AgeStructure.AGE_10_TO_14,
    "Age 15": AgeStructure.AGE_15,
    "Age 16 to 17": AgeStructure.AGE_16_TO_17,
    "Age 18 to 19": AgeStructure.AGE_18_TO_19,
    "Age 20 to 24": AgeStructure.AGE_20_TO_24,
    "Age 25 to 29": AgeStructure.AGE_25_TO_29,
    "Age 30 to 44": AgeStructure.AGE_30_TO_44,
    "Age 45 to 59": AgeStructure.AGE_45_TO_59,
    "Age 60 to 64": AgeStructure.AGE_60_TO_64,
    "Age 65 to 74": AgeStructure.AGE_65_TO_74,
    "Age 75 to 84": AgeStructure.AGE_75_TO_84,
    "Age 85 to 89": AgeStructure.AGE_85_TO_89,
    "Age 90 and over": AgeStructure.AGE_90_AND_OVER
}


ECONOMIC_ACTIVITY_MAP = {
    'Economically active: Employee: Part-time': EconomicActivity.EMPLOYEE_PART_TIME,
    'Economically active: Employee: Full-time': EconomicActivity.EMPLOYEE_FULL_TIME,
    'Economically active: Self-employed': EconomicActivity.SELF_EMPLOYED,
    'Economically active: Unemployed': EconomicActivity.UNEMPLOYED,
    'Economically active: Full-time student': EconomicActivity.ACTIVE_FULL_TIME_STUDENT,
    'Economically inactive: Retired': EconomicActivity.RETIRED,
    'Economically inactive: Student (including full-time students)':
        EconomicActivity.INACTIVE_FULL_TIME_STUDENT,
    'Economically inactive: Looking after home or family': EconomicActivity.LOOKING_AFTER_HOME,
    'Economically inactive: Long-term sick or disabled': EconomicActivity.LONG_TERM_SICK,
    'Economically inactive: Other': EconomicActivity.INACTIVE_OTHER
}


QUALIFICATION_MAP = {
    'No qualifications': Qualification.NO_QUALIFICATIONS,
    'Highest level of qualification: Level 1 qualifications': Qualification.LEVEL_1,
    'Highest level of qualification: Level 2 qualifications': Qualification.LEVEL_2,
    'Highest level of qualification: Apprenticeship': Qualification.APPRENTICESHIP,
    'Highest level of qualification: Level 3 qualifications': Qualification.LEVEL_3,
    'Highest level of qualification: Level 4 qualifications and above': Qualification.LEVEL_45,
    'Highest level of qualification: Other qualifications': Qualification.OTHER_QUALIFICATION
}


HOUSEHOLDTYPE_MAP = {
    'One person household': HouseholdType.ONE_PERSON_HOUSEHOLD,
    'Married couple household: With dependent children':
        HouseholdType.COUPLE_WITH_DEPENDENT_CHILDREN,
    'Married couple household: No dependent children':
        HouseholdType.COUPLE_WITHOUT_DEPENDENT_CHILDREN,
    'Same-sex civil partnership couple household: With dependent children':
        HouseholdType.COUPLE_WITH_DEPENDENT_CHILDREN,
    'Same-sex civil partnership couple household: No dependent children':
        HouseholdType.COUPLE_WITHOUT_DEPENDENT_CHILDREN,
    'Cohabiting couple household: With dependent children':
        HouseholdType.COUPLE_WITH_DEPENDENT_CHILDREN,
    'Cohabiting couple household: No dependent children':
        HouseholdType.COUPLE_WITHOUT_DEPENDENT_CHILDREN,
    'Lone parent household: With dependent children':
        HouseholdType.LONE_PARENT_WITH_DEPENDENT_CHILDREN,
    'Lone parent household: No dependent children':
        HouseholdType.ONE_PERSON_HOUSEHOLD,
    'Multi-person household: All full-time students':
        HouseholdType.MULTI_PERSON_HOUSEHOLD,
    'Multi-person household: Other':
        HouseholdType.MULTI_PERSON_HOUSEHOLD
}


def read_shape_file(study_area=StudyArea.HARINGEY, geographical_layer=GeographicalLayer.LSOA):
    """Reads shape file of the study area from London Data Store.

    Make sure to use requests_cache to cache the retrieved data.
    """
    r = requests.get(LONDON_BOUNDARY_FILE_URL)
    z = zipfile.ZipFile(io.BytesIO(r.content))
    with tempfile.TemporaryDirectory(prefix='london-boundary-files') as tmpdir:
        z.extractall(path=tmpdir)
        shape_file = Path(tmpdir) / geographical_layer.shape_file_path
        data = gpd.read_file(shape_file.as_posix())
    data = data[data[geographical_layer.borough_col_name].isin(study_area.borough_names)]
    return data.set_index(geographical_layer.index_col_name)


def read_age_structure_data(study_area=StudyArea.HARINGEY,
                            geographical_layer=GeographicalLayer.LSOA):
    """Retrieves age structure date from UK Census 2011.

    Data is taken from the KS102EW table from the UK Census 2011.
    Data is retrieved from nomis, see https://www.nomisweb.co.uk.
    """
    if study_area==StudyArea.GREATER_LONDON:
        df = pd.DataFrame()
        for ii in range(0,len(study_area.nomis_geo_codes(geographical_layer))):
            url = (
                "https://www.nomisweb.co.uk/api/v01/dataset/{}.data.csv" +
                "?date=latest&geography={}&rural_urban=0&measures=20100" +
                "&select=geography_code,cell_name,obs_value").format(
                NOMIS_KS102EW_DATASET_ID,
                study_area.nomis_geo_codes(geographical_layer)[ii]
            )
            r = requests.get(url)
            df_temp = pd.read_csv(io.BytesIO(r.content))
            df = df.append(df_temp,ignore_index=True)
        df = df.pivot(
            index='GEOGRAPHY_CODE',
            columns='CELL_NAME',
            values='OBS_VALUE'
        )[list(AGE_STRUCTURE_MAP.keys())].astype(np.int64)
        df = df.rename(columns=AGE_STRUCTURE_MAP).groupby(lambda x: x, axis=1).sum()
    else:
        url = (
            "https://www.nomisweb.co.uk/api/v01/dataset/{}.data.csv" +
            "?date=latest&geography={}&rural_urban=0&measures=20100" +
            "&select=geography_code,cell_name,obs_value").format(
            NOMIS_KS102EW_DATASET_ID,
            study_area.nomis_geo_codes(geographical_layer)
        )
        r = requests.get(url)
        df = pd.read_csv(io.BytesIO(r.content))
        df = df.pivot(
            index='GEOGRAPHY_CODE',
            columns='CELL_NAME',
            values='OBS_VALUE'
        )[list(AGE_STRUCTURE_MAP.keys())].astype(np.int64)
        df = df.rename(columns=AGE_STRUCTURE_MAP).groupby(lambda x: x, axis=1).sum()
    return df




def read_household_type_data(study_area=StudyArea.HARINGEY,
                             geographical_layer=GeographicalLayer.LSOA):
    """Retrieves household type date from UK Census 2011.

    Data is taken from the QS116EW table from the UK Census 2011.
    Data is retrieved from nomis, see https://www.nomisweb.co.uk.
    """
    
    if study_area==StudyArea.GREATER_LONDON:
        df = pd.DataFrame()
        for ii in range(0,len(study_area.nomis_geo_codes(geographical_layer))):
            url = (
                "https://www.nomisweb.co.uk/api/v01/dataset/{}.data.csv" +
                "?date=latest&geography={}&rural_urban=0&measures=20100" +
                "&select=geography_code,c_ahthuk11_name," +
                "obs_value").format(
                NOMIS_QS116EW_DATASET_ID,
                study_area.nomis_geo_codes(geographical_layer)[ii]
            )
            r = requests.get(url)
            df_temp = pd.read_csv(io.BytesIO(r.content))
            df = df.append(df_temp,ignore_index=True)
        df = df.pivot(
            index='GEOGRAPHY_CODE',
            columns='C_AHTHUK11_NAME',
            values='OBS_VALUE'
        )[list(HOUSEHOLDTYPE_MAP.keys())].astype(np.int64)
        df = df.rename(columns=HOUSEHOLDTYPE_MAP).groupby(lambda x: x, axis=1).sum()
    else:
        url = (
            "https://www.nomisweb.co.uk/api/v01/dataset/{}.data.csv" +
            "?date=latest&geography={}&rural_urban=0&measures=20100" +
            "&select=geography_code,c_ahthuk11_name," +
            "obs_value").format(
            NOMIS_QS116EW_DATASET_ID,
            study_area.nomis_geo_codes(geographical_layer)
        )
        r = requests.get(url)
        df = pd.read_csv(io.BytesIO(r.content))
        df = df.pivot(
            index='GEOGRAPHY_CODE',
            columns='C_AHTHUK11_NAME',
            values='OBS_VALUE'
        )[list(HOUSEHOLDTYPE_MAP.keys())].astype(np.int64)
        df = df.rename(columns=HOUSEHOLDTYPE_MAP).groupby(lambda x: x, axis=1).sum()
    return df


def read_qualification_level_data(study_area=StudyArea.HARINGEY,
                                  geographical_layer=GeographicalLayer.LSOA):
    """Retrieves highest qualification level data from UK Census 2011.

    Data is taken from the KS501EW table from the UK Census 2011.
    Data is retrieved from nomis, see https://www.nomisweb.co.uk.
    """
    if study_area==StudyArea.GREATER_LONDON:
        df = pd.DataFrame()
        for ii in range(0,len(study_area.nomis_geo_codes(geographical_layer))):
            url = (
                "https://www.nomisweb.co.uk/api/v01/dataset/{}.data.csv" +
                "?date=latest&geography={}&rural_urban=0&measures=20100" +
                "&select=geography_code,cell_name,obs_value").format(
                NOMIS_KS501EW_DATASET_ID,
                study_area.nomis_geo_codes(geographical_layer)[ii]
            )
            r = requests.get(url)
            df_temp = pd.read_csv(io.BytesIO(r.content))
            df = df.append(df_temp,ignore_index=True)
        df = df.pivot(
            index='GEOGRAPHY_CODE',
            columns='CELL_NAME',
            values='OBS_VALUE'
        )[list(QUALIFICATION_MAP.keys())].astype(np.int64)
        df = df.rename(columns=QUALIFICATION_MAP).groupby(lambda x: x, axis=1).sum()

    else:
        url = (
            "https://www.nomisweb.co.uk/api/v01/dataset/{}.data.csv" +
            "?date=latest&geography={}&rural_urban=0&measures=20100" +
            "&select=geography_code,cell_name,obs_value").format(
            NOMIS_KS501EW_DATASET_ID,
            study_area.nomis_geo_codes(geographical_layer)
        )
        r = requests.get(url)
        df = pd.read_csv(io.BytesIO(r.content))
        df = df.pivot(
            index='GEOGRAPHY_CODE',
            columns='CELL_NAME',
            values='OBS_VALUE'
        )[list(QUALIFICATION_MAP.keys())].astype(np.int64)
        df = df.rename(columns=QUALIFICATION_MAP).groupby(lambda x: x, axis=1).sum()
    return df


def read_economic_activity_data(study_area=StudyArea.HARINGEY,
                                geographical_layer=GeographicalLayer.LSOA):
    """Retrieves economic activity data from UK Census 2011.

    Data is taken from the KS601EW table from the UK Census 2011.
    Data is retrieved from nomis, see https://www.nomisweb.co.uk.
    """
    if study_area==StudyArea.GREATER_LONDON:
        df = pd.DataFrame()
        for ii in range(0,len(study_area.nomis_geo_codes(geographical_layer))):
            url = (
                "https://www.nomisweb.co.uk/api/v01/dataset/{}.data.csv" +
                "?date=latest&geography={}&rural_urban=0&measures=20100" +
                "&c_sex=0" +
                "&select=geography_code,cell_name,obs_value").format(
                NOMIS_KS601EW_DATASET_ID,
                study_area.nomis_geo_codes(geographical_layer)[ii]
            )
            r = requests.get(url)
            df_temp = pd.read_csv(io.BytesIO(r.content))
            df = df.append(df_temp,ignore_index=True)    
        df = df.pivot(
            index='GEOGRAPHY_CODE',
            columns='CELL_NAME',
            values='OBS_VALUE'
        )[list(ECONOMIC_ACTIVITY_MAP.keys())].astype(np.int64)
        df = df.rename(columns=ECONOMIC_ACTIVITY_MAP).groupby(lambda x: x, axis=1).sum()        
    else:
        url = (
            "https://www.nomisweb.co.uk/api/v01/dataset/{}.data.csv" +
            "?date=latest&geography={}&rural_urban=0&measures=20100" +
            "&c_sex=0" +
            "&select=geography_code,cell_name,obs_value").format(
            NOMIS_KS601EW_DATASET_ID,
            study_area.nomis_geo_codes(geographical_layer)
        )
        r = requests.get(url)
        df = pd.read_csv(io.BytesIO(r.content))
        df = df.pivot(
            index='GEOGRAPHY_CODE',
            columns='CELL_NAME',
            values='OBS_VALUE'
        )[list(ECONOMIC_ACTIVITY_MAP.keys())].astype(np.int64)
        df = df.rename(columns=ECONOMIC_ACTIVITY_MAP).groupby(lambda x: x, axis=1).sum()
    return df


def read_pseudo_individual_data(study_area=StudyArea.HARINGEY,
                                geographical_layer=GeographicalLayer.LSOA):
    """Creates pseudo feature data for people.

    The data set will be equivalent to the population sum.
    """
    data = read_age_structure_data(study_area, geographical_layer)
    data[Pseudo.SINGLETON] = data.sum(axis=1)
    return data[[Pseudo.SINGLETON]]


def read_pseudo_household_data(study_area=StudyArea.HARINGEY,
                               geographical_layer=GeographicalLayer.LSOA):
    """Creates pseudo feature data for households.

    The data set will be equivalent to the household sum.
    """
    data = read_household_type_data(study_area, geographical_layer)
    data[Pseudo.SINGLETON] = data.sum(axis=1)
    return data[[Pseudo.SINGLETON]]
